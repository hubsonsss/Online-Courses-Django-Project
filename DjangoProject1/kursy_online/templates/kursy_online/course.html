{% extends "main.html" %}
{% load static %}

{% block content %}
    <link rel="stylesheet" href="{% static 'styles/course.css' %}?v=1.0">
    
    <div class="container-course">
        <div class="students-course">
            <h1>Students</h1>
            <hr>
            
            {% for student in students %}
                <div class="user-info">
                    <img id="image-preview" src="{{ student.image.url }}" alt="Profile Picture">
                    <a href="{% url 'profile' student.id %}" class="teacher-link">@{{ student.username }}</a>
                </div>
                <hr>
            {% endfor %}
        </div>
    
    
        <div class="course-content">
            <div>
                <h1>{{ course.name }}</h1>
                <h3> {{ course.teacher }}</h3>
                <p>{{ course.description }}</p>
                <small>{{ course.subject }}</small>
            </div>
        
            <div>
            {% if user.is_authenticated %}
                {% if user not in students %}
                    {% if user != course.teacher %}
                    <form method="post">
                        {% csrf_token %}
                        <button type="submit" name="join_course" class="btn-join">
                            Join {{ course.name }}.
                        </button>
                    </form>
                    {% else %}
                        <p>This is your course.</p>
                    {% endif %}
                {% else %}
                    <p>You are already a participant in this course.</p>
                    <form method="post">
                        {% csrf_token %}
                        <button type="submit" name="leave_course" class="btn-leave">
                            Leave {{ course.name }}.
                        </button>
                    </form>
                {% endif %}
            {% else %}
                <p>You must be logged in to join this course.</p>
                <a href="{% url 'login' %}">Login</a>
            {% endif %}
        </div>
        

        {% if user.is_authenticated and user in students or user == course.teacher %}
            <div class="comments-list">
                <h3>Messages</h3>
        
                {% for comment in comments %}
                    <div>
                        <div class="user-info">
                            <img id="image-preview-2" src="{{ comment.user.image.url }}" alt="Profile Picture"> 
                            <h5>{{ comment.user }}   {{ comment.created | timesince}} ago</h5>
                            {% if request.user == comment.user %}
                                <a href="{% url "delete_message" comment.id%}">Delete</a>
                            {% endif %}
                        </div>
                        <p>
                           {{ comment.message }}
                        </p>
                    </div>
                    <hr>
                {% endfor %}
            </div>
        
            <div class="comment-form">
                <form method="post" action="">
                    {% csrf_token %}
                    <label for="comment"></label>
                    <textarea id="comment" name="comment" rows="5" cols="40" placeholder="Write your message..."></textarea>
                    <button type="submit">Send</button>
                </form>
            </div>
        {% endif %}
        </div>
        <div>
            <h1>Coś tu będzie</h1>
        </div>
    </div>
{% endblock %}